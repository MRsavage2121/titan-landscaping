<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login/Register - Titan Handyman</title>
<link rel="stylesheet" href="css/style.css">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyDZ0VGdu2CoK5YY7d3__drDy8OW_bAkfCM",
    authDomain: "titan-company.firebaseapp.com",
    projectId: "titan-company",
    storageBucket: "titan-company.firebasestorage.app",
    messagingSenderId: "993876361774",
    appId: "1:993876361774:web:b39b768c2a9054c9d2d5bf",
    measurementId: "G-QY2XM9Y08Y"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
</script>
</head>
<body>

<section class="login">
  <h2>Titan Handyman Login / Register</h2>

  <input type="email" id="email" placeholder="Email" required>
  <input type="password" id="password" placeholder="Password" required>

  <button id="loginBtn" class="btn">Login</button>
  <button id="registerBtn" class="btn" type="button">Register</button>
</section>

<script>
const loginBtn = document.getElementById('loginBtn');
const registerBtn = document.getElementById('registerBtn');

// LOGIN
loginBtn.addEventListener('click', () => {
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value.trim();

    if (!email || !password) {
        alert('Please enter email and password.');
        return;
    }

    auth.signInWithEmailAndPassword(email, password)
        .then(userCredential => {
            const user = userCredential.user;
            db.collection('users').doc(user.uid).get().then(doc => {
                if (doc.exists) {
                    const role = doc.data().role;
                    if (role === 'admin') {
                        window.location.href = 'admin-dashboard.html';
                    } else {
                        window.location.href = 'customer-dashboard.html';
                    }
                } else {
                    alert('User data not found!');
                }
            });
        })
        .catch(error => {
            alert(error.message);
        });
});

// REGISTER
registerBtn.addEventListener('click', () => {
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value.trim();

    if (!email || !password) {
        alert('Please enter email and password.');
        return;
    }

    auth.createUserWithEmailAndPassword(email, password)
        .then(userCredential => {
            const user = userCredential.user;
            db.collection('users').doc(user.uid).set({
                email: email,
                role: 'customer',
                points: 0
            }).then(() => {
                alert('Registration successful!');
                window.location.href = 'customer-dashboard.html';
            });
        })
        .catch(error => {
            alert(error.message);
        });
});
</script>

</body>
</html>
